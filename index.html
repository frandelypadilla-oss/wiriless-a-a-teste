<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireless A&A - Liquid Glass Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;300;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.12);
            --accent: #00f2ff;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #020205;
            font-family: 'Outfit', sans-serif;
            color: white;
            overflow: hidden;
        }

        .background-visuals {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .orb {
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.3;
            animation: float 15s infinite alternate ease-in-out;
        }
        .orb-blue { background: #0066ff; top: -10%; left: -10%; }
        .orb-red { background: #ff2200; bottom: -10%; right: -10%; animation-delay: -7s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(100px, 50px) scale(1.2); }
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(40px) saturate(160%);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 60px 40px;
            text-align: center;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
        }

        .brand {
            font-size: 2rem;
            font-weight: 100;
            letter-spacing: 10px;
            text-transform: uppercase;
            margin-bottom: 30px;
            background: linear-gradient(to bottom, #fff, rgba(255,255,255,0.3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-label {
            opacity: 0.5;
            font-size: 0.6rem;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }

        .speed-container {
            display: flex;
            align-items: baseline;
            justify-content: center;
            margin-bottom: 10px;
        }

        .speed-value {
            font-size: 100px;
            font-weight: 900;
            margin: 0;
            letter-spacing: -4px;
        }

        .unit {
            font-size: 1.2rem;
            font-weight: 300;
            margin-left: 10px;
            color: var(--accent);
        }

        canvas {
            width: 100%;
            height: 60px;
        }

        .progress-container {
            width: 100%;
            height: 3px;
            background: rgba(255,255,255,0.05);
            margin: 25px 0;
            border-radius: 10px;
            overflow: hidden;
        }
        #pBar { 
            width: 0%; 
            height: 100%; 
            background: var(--accent); 
            box-shadow: 0 0 15px var(--accent);
            transition: width 0.3s linear;
        }

        .btn-test {
            background: transparent;
            border: 1px solid var(--border);
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 0.7rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-test:hover:not(:disabled) {
            background: white;
            color: black;
        }
        .btn-test:disabled { opacity: 0.3; cursor: not-allowed; }

        .recommendation {
            margin-top: 25px;
            font-size: 0.85rem;
            height: 20px;
            opacity: 0;
            transform: translateY(10px);
            transition: 0.5s;
        }
        .show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

    <div class="background-visuals">
        <div class="orb orb-blue"></div>
        <div class="orb orb-red"></div>
    </div>

    <div class="glass-card">
        <div class="brand">Wireless A&A</div>
        <p class="status-label" id="status-text">LISTO PARA ANALIZAR</p>
        
        <div class="speed-container">
            <h1 class="speed-value" id="speed">0</h1>
            <span class="unit">Mbps</span>
        </div>

        <canvas id="waveCanvas"></canvas>

        <div class="progress-container">
            <div id="pBar"></div>
        </div>

        <button class="btn-test" id="startBtn">Iniciar AnÃ¡lisis</button>

        <div class="recommendation" id="recBox">
            <p id="recText"></p>
        </div>
    </div>

    <script>
        const speedEl = document.getElementById('speed');
        const pBar = document.getElementById('pBar');
        const startBtn = document.getElementById('startBtn');
        const recBox = document.getElementById('recBox');
        const recText = document.getElementById('recText');
        const statusText = document.getElementById('status-text');
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = 400;
        canvas.height = 60;
        let offset = 0;
        let waveIntensity = 1;

        // AnimaciÃ³n de ondas suave
        function animateWaves() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = '#00f2ff';
            ctx.lineWidth = 2;
            
            for (let x = 0; x <= canvas.width; x += 5) {
                // La onda reacciona sutilmente a la velocidad simulada
                let y = 30 + Math.sin(x * 0.03 + offset) * (10 * waveIntensity);
                x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            }
            ctx.stroke();
            offset += 0.08;
            requestAnimationFrame(animateWaves);
        }
        animateWaves();

        // LÃ³gica de mediciÃ³n mejorada
        const testFile = "https://speed.cloudflare.com/__down?bytes=15000000"; // 15MB

        async function runTest() {
            startBtn.disabled = true;
            startBtn.innerText = "Midiendo...";
            recBox.classList.remove('show');
            statusText.innerText = "DESCARGANDO PAQUETES...";
            
            const startTime = performance.now();
            let progress = 0;
            
            // SimulaciÃ³n visual de progreso mientras descarga
            const progressInterval = setInterval(() => {
                if (progress < 90) {
                    progress += 0.5;
                    pBar.style.width = progress + "%";
                }
            }, 100);

            try {
                const response = await fetch(testFile + "&cb=" + Date.now());
                const reader = response.body.getReader();
                let receivedLength = 0;
                
                // Procesar la descarga por fragmentos para calcular velocidad real
                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    receivedLength += value.length;
                }

                const endTime = performance.now();
                const durationInSeconds = (endTime - startTime) / 1000;
                const bitsLoaded = receivedLength * 8;
                const speedMbps = (bitsLoaded / 1024 / 1024) / durationInSeconds;

                // Resultado final
                clearInterval(progressInterval);
                pBar.style.width = "100%";
                speedEl.innerText = speedMbps.toFixed(1);
                showRec(speedMbps);

            } catch (error) {
                console.error(error);
                statusText.innerText = "ERROR DE CONEXIÃ“N";
                startBtn.disabled = false;
            }
        }

        function showRec(speed) {
            startBtn.disabled = false;
            startBtn.innerText = "Repetir Test";
            statusText.innerText = "ANÃLISIS COMPLETADO";
            recBox.classList.add('show');
            
            if(speed > 60) recText.innerHTML = "âœ¨ <b>Ultra-Fluid:</b> Calidad mÃ¡xima para 4K y Cine Digital.";
            else if(speed > 25) recText.innerHTML = "ðŸŽ¬ <b>HD-Smooth:</b> Perfecto para streaming 1080p.";
            else recText.innerHTML = "ðŸ“± <b>Mobile-Ready:</b> Ã“ptimo para redes sociales.";
        }

        startBtn.addEventListener('click', runTest);
    </script>
</body>
</html>